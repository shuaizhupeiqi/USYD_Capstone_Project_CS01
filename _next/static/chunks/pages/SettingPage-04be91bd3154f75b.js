(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7483],{90740:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/SettingPage",function(){return i(98244)}])},98244:function(e,t,i){"use strict";i.r(t);var n=i(67573),s=i(85893),a=i(67294),o=i(11163),l=i.n(o),r=i(96108),d=i(79531),h=i(46409),c=i(71577),u=i(96074),g=i(55241),p=i(53575),f=i(98293),m=i(4340),S=i(4480),v=i(56886),x=i(23681),Z=i(81921),y=i(19996),I=i(51146),j=i(3253),C=i(18429),b=i(60219),O=i(19426),E=i(83005),P=i(75884),w=i(39960),A=i(37744),k=i(44866);i(48562),i(61800);var L=i(96486),F=i(53416);let V=window.innerWidth<=768;class T extends a.Component{componentDidMount(){this.loadTranslation()}componentWillUnmount(){this.state.latestFormValues&&!this.state.saveButtonClicked&&this.onSaveData(this.state.latestFormValues,!1)}async loadTranslation(){let{languageHelper:e}=this.props,t=await e.translation("SettingPage",!0);(0,P.a)(async(e,i)=>{this.setState({user:i}),e&&this.setState({isLoggedIn:!0}),i&&i.emailVerified&&this.setState({isEmailVerified:!0});let n=(0,E.y)();if(e&&i&&i.emailVerified)try{let n=await (0,A.xK)("users/".concat(i.uid));this.setState({data:n.settings,translation:t.translation,settingOptions:t.data,isLoggedIn:e,loading:!1})}catch(s){console.error("Operation failed:",s);let i={};n&&(i=n),this.setState({data:i,translation:t.translation,settingOptions:t.data,isLoggedIn:e,loading:!1})}else{var s,a;n&&(0,L.isNil)(null===(s=this.props)||void 0===s?void 0:null===(a=s.query)||void 0===a?void 0:a.userIndex)?this.setState({data:n,translation:t.translation,settingOptions:t.data,isLoggedIn:e,loading:!1}):this.setState({data:{},translation:t.translation,settingOptions:t.data,isLoggedIn:e,loading:!1})}})}generateFormElements(e,t){return"multiple"===e.optionType?this.generateMultipleOption(e,t):"input"===e.optionType?this.generateInput(e,t):this.generateSingleOption(e,t)}generateInput(e,t){return(0,s.jsx)(r.Z.Item,{label:e.label,name:e.name,children:(0,s.jsx)(d.Z,{allowClear:!0})},t)}generateSingleOption(e,t){return(0,s.jsx)(r.Z.Item,{label:e.label,name:e.name,children:(0,s.jsx)(h.Z,{allowClear:!0,children:e.options.map((e,i)=>(0,s.jsx)(h.Z.Option,{value:JSON.stringify(e.value),children:e.label},i+t))})},t)}generateMultipleOption(e,t){let i=e.options.map(e=>({label:e.label,value:JSON.stringify(e.value)}));return(0,s.jsx)(r.Z.Item,{label:e.label,name:e.name,children:(0,s.jsx)(h.Z,{mode:"multiple",showArrow:!0,style:{width:"100%"},allowClear:!0,options:i})},t)}NotVerfiedHeader(){return(0,s.jsx)("div",{children:V?null:(0,s.jsx)("div",{style:{width:"97%",backgroundColor:"salmon",marginTop:"1%",borderRadius:"10px",paddingLeft:"3%",color:"white"},children:(0,s.jsxs)("p",{children:[this.state.translation.NotVerifiedNote," â€ƒ",(0,s.jsx)("span",{onClick:this.resendVerificationEmail,style:{cursor:"pointer",textDecoration:"underline",color:"blue"},children:this.state.translation.ResendLink})]})})})}UserNameHeader(){let e=this.state.user;return e?(0,s.jsxs)("p",{children:[this.state.translation.Hello,": ",e.displayName]}):null}openProfilePage(){this.setState({openProfile:!0})}renderLoggedInButton(){return(0,s.jsx)(c.ZP,{style:{backgroundColor:"#005B8E",color:"white",fontWeight:"bold"},onClick:this.openProfilePage.bind(this),children:this.state.translation.ManageYourProfile})}render(){return(0,s.jsxs)("div",{style:this.state.openProfile?{width:"100vw",position:"fixed"}:null,children:[this.state.openProfile?(0,s.jsx)(I.Z,{doSignOut:this.doSignOut,closeProfilePage:this.closeProfilePage}):null,(0,s.jsxs)(x.default,{children:[this.state.isLoggedIn&&!this.state.isEmailVerified?this.NotVerfiedHeader():null,this.state.loading?(0,s.jsx)(y.Z,{}):(0,s.jsxs)(s.Fragment,{children:[this.renderUserButton(),(0,s.jsxs)(r.Z,{ref:this.formRef,labelCol:{span:24},wrapperCol:{span:24},layout:"vertical",initialValues:this.state.data,onValuesChange:this.onFormValueChange,size:this.state.componentSize,style:{maxWidth:"100%"},onFinish:this.onSaveData,onFinishFailed:this.onSaveDataFailed,children:[(0,s.jsx)(u.Z,{orientation:"left",style:{color:"#001219#"},children:this.state.isLoggedIn?this.UserNameHeader():null}),(0,s.jsx)(r.Z.Item,{children:this.state.isLoggedIn?this.renderLoggedInButton():(0,s.jsx)(g.Z,{content:(0,s.jsx)("div",{id:"firebaseui"}),title:(0,s.jsxs)("div",{children:[(0,s.jsx)(j.Z,{}),(0,s.jsx)(C.Z,{style:{float:"right"},onClick:this.handlePopoverClose})]}),trigger:"click",open:this.state.open,onOpenChange:this.handleOpenChange,autoAdjustOverflow:!0,getPopupContainer:e=>e.parentNode,children:(0,s.jsx)(c.ZP,{style:{backgroundColor:"#005B8E",color:"white",fontWeight:"bold"},icon:(0,s.jsx)(j.Z,{}),children:this.state.translation.LoginButton})})}),(0,s.jsx)(u.Z,{orientation:"left",children:this.state.translation.LanguageSelector}),(0,s.jsx)(r.Z.Item,{children:(0,s.jsx)(O.ZP,{})}),(0,s.jsx)(u.Z,{orientation:"left",children:this.state.translation.FormLabel}),this.state.settingOptions.map((e,t)=>this.generateFormElements(e,t+"FormOption")),(0,s.jsx)(r.Z.Item,{children:(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,s.jsx)(c.ZP,{style:{backgroundColor:"#005B8E",color:"white",fontWeight:"bold",justifyContent:"center"},htmlType:"submit",icon:(0,s.jsx)(b.Z,{}),children:this.state.translation.SaveYourChanges})})})]})]})]})]})}constructor(e){var t,o;super(e),t=this,(0,n.Z)(this,"formRef",a.createRef()),(0,n.Z)(this,"state",{componentSize:"middle",curIndex:null===(o=this.props)||void 0===o?void 0:o.curIndex,loading:!0,isLoggedIn:!1,isEmailVerified:!1,data:{},translation:{FormLabel:"Personalize your setting: ",LanguageSelector:"Change Language:",BackToHomePageButton:"Home Page",AddNewPeople:"add a new user",LoginButton:"Login to enable email notification",FormSizeLabel:"Form Size",FormSizeButtonSmall:"Small",FormSizeButtonMiddle:"Middle",FormSizeButtonLarge:"Large",FormAgeSelectionLabel:"Select your age group:",FormIsIllnessLabel:"Do you have any chronic illness?",FormRiskGroupLabel:"Are you in any this groups at greater risk?",FormIsTakingMedLabel:"Are you taking any medications?",yes:"yes",no:"no",riskGroupOptions:[{label:"people who are overweight",value:"gold"},{label:"pregnant women and breastfeeding mothers",value:"cyan"}]},settingOptions:[],openProfile:!1}),(0,n.Z)(this,"onFormValueChange",(e,t)=>{this.setState({latestFormValues:t})}),(0,n.Z)(this,"handleBackToHomePage",e=>{this.setState({loading:!0}),l().push({pathname:"/"})}),(0,n.Z)(this,"handleOpenChange",e=>{e?this.setState({open:!0},()=>{this.doLogin()}):this.setState({open:!1})}),(0,n.Z)(this,"handlePopoverClose",()=>{this.setState({open:!1})}),(0,n.Z)(this,"doLogin",()=>{let e=i(74811);(e.auth.AuthUI.getInstance()||new e.auth.AuthUI(k.Z.auth())).start("#firebaseui",{callbacks:{signInSuccessWithAuthResult:async(e,t)=>{this.setState({open:!1});let i=e.additionalUserInfo.isNewUser;return e.user.emailVerified||this.setState({isEmailVerified:!1}),i&&(e.user.emailVerified?(0,A.pN)("users/".concat(e.user.uid),{emailSubscription:!0}).then(()=>{console.log("Operation successful")}).catch(e=>(console.error("Operation failed:",e),(0,w.Z)("error",this.state.translation.Alert.Error.SomethingWentWrongTitle,this.state.translation.Alert.Error.SaveDataErrorDescription),!1)):((0,w.Z)("success",this.state.translation.Alert.Success.LoginSuccessTitle,this.state.translation.Alert.Success.LoginSuccessDescription),e.user.sendEmailVerification().then(()=>{(0,w.Z)("info",this.state.translation.Alert.Info.EmailverficationTitle,this.state.translation.Alert.Info.EmailverficationDescription)}),this.setState({loading:!0}),await this.loadTranslation())),(0,w.Z)("success",this.state.translation.Alert.Success.LoginSuccessTitle,this.state.translation.Alert.Success.LoginSuccessDescription),this.setState({loading:!0}),await this.loadTranslation(),!0}},signInFlow:"popup",signInOptions:[k.Z.auth.EmailAuthProvider.PROVIDER_ID,k.Z.auth.GoogleAuthProvider.PROVIDER_ID],tosUrl:"<your-tos-url>",privacyPolicyUrl:"<your-privacy-policy-url>"})}),(0,n.Z)(this,"doSignOut",()=>{k.Z.auth().signOut().then(()=>{this.setState({user:null,openProfile:!1}),(0,w.Z)("success",this.state.translation.Alert.Success.SignOutSuccessTitle,this.state.translation.Alert.Success.SignOutSuccessDescription);let e=this.formRef.current.getFieldsValue();this.handleCreateUser(e)}).catch(e=>{console.error("Error logging out:",e),(0,w.Z)("error",this.state.translation.Alert.Error.SignOutErrorTitle,this.state.translation.Alert.Error.SignOutErrorDescription)})}),(0,n.Z)(this,"renderUserButton",()=>{let{userInfo:e}=this.props,{curIndex:t}=this.state;return console.log("888",e),(0,s.jsx)("div",{style:{display:"flex",justifyContent:"space-around",alignItems:"center",width:"100%",marginTop:"20px"},children:null==e?void 0:e.map((e,i)=>{var n,a,o;return(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[" ",(0,L.isEmpty)(e)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f.C,{size:100,style:{cursor:"pointer",backgroundColor:i===t?"#f56a00":"#eee"},onClick:()=>this.handleButtonClick(i),children:this.state.translation.AddNewPeople}),(0,s.jsx)("h4",{children:"\xa0"})," "]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(p.Z,{count:(0,s.jsx)(m.Z,{onClick:()=>this.handleDelteuser(i),style:{color:"red",fontSize:22}}),children:(0,s.jsx)(f.C,{size:100,onClick:()=>this.handleCurUserChange(e,i),style:{backgroundColor:i===t?"#f56a00":"#eee",cursor:"pointer"},children:null===(n=null==e?void 0:null===(a=e.firstName)||void 0===a?void 0:a.substring(0,1))||void 0===n?void 0:n.toLocaleUpperCase()})}),(0,s.jsx)("h4",{children:(null==e?void 0:e.Relationship)?null===(o=JSON.parse(null==e?void 0:e.Relationship))||void 0===o?void 0:o.label:""})]})]})})})}),(0,n.Z)(this,"handleDelteuser",e=>{let{setUserInfo:t,userInfo:i}=this.props,n=null==i?void 0:i[e],s=[...i];if(s.splice(e,1,null),null==n?void 0:n.check){let e=null==s?void 0:s.findIndex(e=>!!e);-1!=e&&s.splice(e,1,{...null==s?void 0:s[e],check:!0})}t(s),localStorage.setItem("allValue",JSON.stringify(s))}),(0,n.Z)(this,"handleButtonClick",e=>{var t,i;let n=null===(t=this.state.settingOptions)||void 0===t?void 0:t.reduce((e,t)=>({...e,[t.name]:void 0}),{});console.log("111111111",n),null===(i=this.formRef.current)||void 0===i||i.setFieldsValue({...n}),this.setState({curIndex:e})}),(0,n.Z)(this,"handleCurUserChange",(e,t)=>{var i;null===(i=this.formRef.current)||void 0===i||i.setFieldsValue({...e}),this.setState({curIndex:t})}),(0,n.Z)(this,"handleCreateUser",e=>{var t,i,n;let{curIndex:s}=this.state,{setUserInfo:a,userInfo:o}=this.props,l=null==o?void 0:o[s],r={uid:(0,F.x0)(),...l,...e},d=[...o];d.splice(s,1,r),(null===(t=null==d?void 0:d.filter(e=>!!e))||void 0===t?void 0:t.length)===1&&(d=null==d?void 0:d.map(e=>e?{...e,check:!0}:e)),a(d),localStorage.setItem("allValue",JSON.stringify(d)),console.log("798",d);let h=null===(i=this.state.settingOptions)||void 0===i?void 0:i.reduce((e,t)=>({...e,[t.name]:void 0}),{});null===(n=this.formRef.current)||void 0===n||n.setFieldsValue({...h})}),(0,n.Z)(this,"onSaveData",async function(e){let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=await (0,P.b)();i&&t.setState({saveButtonClicked:!0}),n?n.emailVerified?(0,A.pN)("users/".concat(n.uid),{settings:e}).then(()=>{console.log("Operation successful")}).catch(i=>{console.error("Operation failed:",i),(0,w.Z)("error",t.state.translation.Alert.Error.SomethingWentWrongTitle,t.state.translation.Alert.Error.SaveDataErrorDescription),t.handleCreateUser(e)}):((0,w.Z)("info",t.state.translation.Alert.Info.SettingSavedTitle,t.state.translation.Alert.Info.SettingSavedAskToVeriftyDescription),t.handleCreateUser(e)):((0,w.Z)("info",t.state.translation.Alert.Info.SettingSavedTitle,t.state.translation.Alert.Info.LoginToSaveYourDataDescription),t.handleCreateUser(e)),(0,w.Z)("success",t.state.translation.Alert.Success.SettingSavedTitle,t.state.translation.Alert.Success.SettingSavedDescription),i&&t.handleBackToHomePage()}),(0,n.Z)(this,"onSaveDataFailed",e=>{console.log(e),(0,w.Z)("error",this.state.translation.Alert.Error.SaveFailedTitle,this.state.translation.Alert.Error.SomethingWentWrongTitle)}),(0,n.Z)(this,"resendVerificationEmail",()=>{let e=k.Z.auth().currentUser;e&&e.sendEmailVerification().then(()=>{(0,w.Z)("info",this.state.translation.Alert.Info.EmailverficationTitle,this.state.translation.Alert.Info.EmailverficationDescription)}).catch(e=>{console.error("Error sending email verification:",e)})}),(0,n.Z)(this,"closeProfilePage",()=>{this.setState({openProfile:!1})})}}let D=e=>{let[t,i]=(0,S.FV)(v.ge),n=(0,a.useMemo)(()=>{let e=null==t?void 0:t.findIndex(e=>null==e?void 0:e.check);return -1!==e?e:0},[t]);return(0,s.jsx)(T,{...e,userInfo:t,curIndex:n,setUserInfo:i})};t.default=(0,o.withRouter)((0,Z.O)(D))}},function(e){e.O(0,[3662,2016,1627,2677,8717,5871,4496,6409,4689,4038,155,3681,3230,9774,2888,179],function(){return e(e.s=90740)}),_N_E=e.O()}]);